---
/**
 * FreshnessIndicator Component
 * Content Freshness Signals - Shows publish/update dates visibly
 */

export interface Props {
  publishedAt: Date;
  updatedAt: Date;
  reviewedBy?: string;
  contentVersion?: string;
  showVersion?: boolean;
}

const { 
  publishedAt, 
  updatedAt, 
  reviewedBy,
  contentVersion,
  showVersion = false
} = Astro.props;

const formatDate = (date: Date, style: 'short' | 'long' = 'long') => {
  return new Intl.DateTimeFormat('tr-TR', {
    year: 'numeric',
    month: style === 'long' ? 'long' : 'short',
    day: style === 'long' ? 'numeric' : undefined
  }).format(date);
};

// Calculate freshness (< 90 days = fresh)
const daysSinceUpdate = Math.floor(
  (Date.now() - updatedAt.getTime()) / (1000 * 60 * 60 * 24)
);
const isFresh = daysSinceUpdate < 90;
const isStale = daysSinceUpdate > 180;
---

<div class="freshness-indicator">
  <div class="freshness-dates">
    <span class="date-item published">
      <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
      <span class="label">Yayın:</span>
      <time datetime={publishedAt.toISOString()}>
        {formatDate(publishedAt)}
      </time>
    </span>
    
    <span class={`date-item updated ${isFresh ? 'fresh' : ''} ${isStale ? 'stale' : ''}`}>
      <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="23 4 23 10 17 10"></polyline>
        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
      </svg>
      <span class="label">Güncelleme:</span>
      <time datetime={updatedAt.toISOString()}>
        {formatDate(updatedAt)}
      </time>
      {isFresh && <span class="badge fresh-badge">Güncel</span>}
      {isStale && <span class="badge stale-badge">Güncelleme Gerekli</span>}
    </span>
  </div>
  
  <div class="freshness-meta">
    {reviewedBy && (
      <span class="reviewer">
        <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        İnceleyen: {reviewedBy}
      </span>
    )}
    
    {showVersion && contentVersion && (
      <span class="version">
        v{contentVersion}
      </span>
    )}
  </div>
</div>

<style>
  .freshness-indicator {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    padding: 0.875rem 1.25rem;
    background: #f8f9fa;
    border-radius: 8px;
    font-size: 0.9rem;
    color: #555;
    margin-bottom: 1.5rem;
    border: 1px solid #e9ecef;
  }
  
  .freshness-dates {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
  }
  
  .date-item {
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }
  
  .icon {
    flex-shrink: 0;
    opacity: 0.7;
  }
  
  .label {
    font-weight: 500;
    color: #666;
  }
  
  time {
    color: #333;
  }
  
  .updated.fresh time {
    color: #28a745;
    font-weight: 500;
  }
  
  .updated.stale time {
    color: #dc3545;
  }
  
  .badge {
    padding: 0.15rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }
  
  .fresh-badge {
    background: #d4edda;
    color: #155724;
  }
  
  .stale-badge {
    background: #f8d7da;
    color: #721c24;
  }
  
  .freshness-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  
  .reviewer {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    color: #666;
  }
  
  .version {
    font-size: 0.75rem;
    padding: 0.2rem 0.5rem;
    background: #e9ecef;
    border-radius: 4px;
    color: #666;
    font-family: monospace;
  }
  
  @media (max-width: 640px) {
    .freshness-indicator {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .freshness-dates {
      flex-direction: column;
      gap: 0.5rem;
    }
  }
</style>
